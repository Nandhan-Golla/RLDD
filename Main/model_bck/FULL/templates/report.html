{% extends "base.html" %}
{% block title %}Treatment Report - LUMINARIX{% endblock %}
{% block content %}
    <h1>LUMINARIX Treatment Report</h1>
    <p><strong>Recommended Drug:</strong> {{ drug }}</p>
    <p><strong>SMILES:</strong> {{ smiles }}</p>
    
    <h2>Treatment Trajectory</h2>
    <img src="data:image/png;base64,{{ trajectory_plot }}" alt="Trajectory Plot">
    
    <h2>Drug Effects Comparison</h2>
    <img src="data:image/png;base64,{{ drug_plot }}" alt="Drug Effects Plot">
    
    <h2>3D Structure of Recommended Drug: {{ drug }}</h2>
    {% if drug_structure_plot %}
        <img src="data:image/png;base64,{{ drug_structure_plot }}" alt="Drug Structure Plot">
    {% else %}
        <p>No 3D structure available for {{ drug }}.</p>
    {% endif %}
    
    <h2>Treatment Details</h2>
    <table>
        <tr><th>Step</th><th>Hemoglobin (g/dL)</th><th>Glucose (mg/dL)</th><th>Reward</th></tr>
        {% if history and rewards %}
            {% for i in range(history|length) %}
                <tr>
                    <td>{{ i+1 }}</td>
                    <td>{{ (history[i][0] if history[i][0] is not none else 0)|round(1) }}</td>
                    <td>{{ (history[i][1] if history[i][1] is not none else 0)|round(1) }}</td>
                    <td>{{ (rewards[i] if rewards[i] is not none else 0)|round(2) }}</td>
                </tr>
            {% endfor %}
        {% else %}
            <tr><td colspan="4">No data available</td></tr>
        {% endif %}
    </table>
    
    <p><a href="{{ url_for('download_trajectory') }}">Download Trajectory Plot</a></p>
    <p><a href="{{ url_for('download_drug_effects') }}">Download Drug Effects Plot</a></p>
    <p><a href="{{ url_for('download_drug_structure') }}">Download Drug Structure Plot</a></p>
    <p><a href="{{ url_for('upload_file') }}">Analyze Another</a></p>
{% endblock %}